(self.webpackChunkpity=self.webpackChunkpity||[]).push([[8407],{12554:function(ce,B,t){"use strict";t.d(B,{Z:function(){return j}});var R=t(67294),x=t(7134),Y=t(83062),O={menu:"menu___lmCy5",right:"right___j6QWS",action:"action___qDzB9",search:"search___XbFIL",account:"account___t6Nrx",avatar:"avatar___B76fn",dark:"dark___VDMBa","ant-badge-count-sm":"ant-badge-count-sm___oPFlX"},w=t(19478),i=Object.defineProperty,E=Object.getOwnPropertySymbols,b=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,S=(g,s,v)=>s in g?i(g,s,{enumerable:!0,configurable:!0,writable:!0,value:v}):g[s]=v,L=(g,s)=>{for(var v in s||(s={}))b.call(s,v)&&S(g,v,s[v]);if(E)for(var v of E(s))H.call(s,v)&&S(g,v,s[v]);return g};const u=g=>React.createElement("svg",L({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 500 500",xmlSpace:"preserve"},g),React.createElement("linearGradient",{id:"logo_svg__a",gradientUnits:"userSpaceOnUse",x1:413.111,y1:255.835,x2:145.446,y2:255.835},React.createElement("stop",{offset:.034,style:{stopColor:"#e700e6"}}),React.createElement("stop",{offset:1,style:{stopColor:"#29abe2"}})),React.createElement("path",{fill:"url(#logo_svg__a)",d:"m475.4 248.3-93.7-124.9c0-.1-.1-.1-.2-.2-.2-.2-.4-.5-.6-.7l-.3-.3-.8-.8c-.1 0-.1-.1-.2-.2-.3-.3-.7-.5-1.1-.8-.1-.1-.2-.1-.3-.2-.3-.2-.6-.4-.9-.5-.1-.1-.2-.1-.4-.2-.3-.1-.6-.3-.9-.4-.1 0-.3-.1-.4-.1l-.9-.3c-.1 0-.3-.1-.4-.1-.3-.1-.7-.1-1-.2-.1 0-.2 0-.4-.1-.5-.1-.9-.1-1.4-.1H117.6c-6.9 0-12.5 5.6-12.5 12.5s5.6 12.5 12.5 12.5h79.5c4.8 0 8.7 3.9 8.7 8.8 0 2.4-1 4.6-2.6 6.2-1.6 1.6-3.8 2.6-6.2 2.6H72.2c-6.9 0-12.5 5.6-12.5 12.5s5.6 12.5 12.5 12.5h90.1c7.6 0 13.7 6.2 13.7 13.7 0 3.8-1.5 7.2-4 9.7-2.5 2.5-5.8 4-9.6 4H28.5c-6.9 0-12.5 5.6-12.5 12.5s5.6 12.5 12.5 12.5h83.3c9.6 0 17.5 7.9 17.5 17.5 0 4.8-2 9.2-5.1 12.4-3.2 3.2-7.5 5.1-12.3 5.1h-52c-6.9 0-12.5 5.6-12.5 12.5s5.6 12.5 12.5 12.5H157c3.9 0 7.5 1.2 10.4 3.3 3.4 2.3 6.1 5.8 7.3 9.8.6 1.8.9 3.7.9 5.8 0 5.2-2.1 9.9-5.5 13.3-3.4 3.4-8.1 5.5-13.3 5.5H123c-6.9 0-12.5 5.6-12.5 12.5s5.6 12.5 12.5 12.5H201.9c2 0 3.6 1.6 3.6 3.6 0 1-.4 1.9-1.1 2.6-.6.7-1.6 1.1-2.5 1.1h-17.1c-6.9 0-12.5 5.6-12.5 12.5s5.6 12.5 12.5 12.5h186.8c.5 0 1 0 1.5-.1s.9-.1 1.3-.2c.1 0 .1 0 .2-.1.4-.1.8-.2 1.1-.3.1 0 .2-.1.2-.1.4-.1.7-.3 1-.4.1 0 .2-.1.2-.1.3-.2.7-.4 1-.6.1 0 .1-.1.2-.1.4-.3.8-.5 1.1-.8l.1-.1c.3-.3.6-.5.9-.8l.3-.3c.2-.2.4-.4.6-.7l.2-.2 93.7-124.9c3.5-4.5 3.5-10.6.2-15.1zM288 143.4h58.7l-37.5 50-37.5-50H288zm-109.2 98.8 13-17.3 34.7-46.4 5.3-7.1 14.9-19.8 6.3 8.4 40.5 54-21.9 29.2H178l.8-1zM253 368.3l-15.8-21-40.6-54.1-9.9-13.2-8.7-11.6h93.7l75 100H253zm169.3-75.8L392 255.8l-13.4 19.1 29.9 36.1-36.7 49-78.1-104.1 78.1-104.1 78.1 104.1-27.6 36.6z"}),React.createElement("linearGradient",{id:"logo_svg__b",gradientUnits:"userSpaceOnUse",x1:413.111,y1:166.309,x2:145.445,y2:166.309},React.createElement("stop",{offset:.034,style:{stopColor:"#e700e6"}}),React.createElement("stop",{offset:1,style:{stopColor:"#29abe2"}})),React.createElement("path",{fill:"url(#logo_svg__b)",d:"M331.9 152.6h-42.7l20.6 27.4z"}));var D="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MDAgNTAwIiB4bWw6c3BhY2U9InByZXNlcnZlIj48bGluZWFyR3JhZGllbnQgaWQ9ImEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNDEzLjExMSIgeTE9IjI1NS44MzUiIHgyPSIxNDUuNDQ2IiB5Mj0iMjU1LjgzNSI+PHN0b3Agb2Zmc2V0PSIuMDM0IiBzdHlsZT0ic3RvcC1jb2xvcjojZTcwMGU2Ii8+PHN0b3Agb2Zmc2V0PSIxIiBzdHlsZT0ic3RvcC1jb2xvcjojMjlhYmUyIi8+PC9saW5lYXJHcmFkaWVudD48cGF0aCBmaWxsPSJ1cmwoI2EpIiBkPSJtNDc1LjQgMjQ4LjMtOTMuNy0xMjQuOWMwLS4xLS4xLS4xLS4yLS4yLS4yLS4yLS40LS41LS42LS43bC0uMy0uMy0uOC0uOGMtLjEgMC0uMS0uMS0uMi0uMi0uMy0uMy0uNy0uNS0xLjEtLjgtLjEtLjEtLjItLjEtLjMtLjItLjMtLjItLjYtLjQtLjktLjUtLjEtLjEtLjItLjEtLjQtLjItLjMtLjEtLjYtLjMtLjktLjQtLjEgMC0uMy0uMS0uNC0uMWwtLjktLjNjLS4xIDAtLjMtLjEtLjQtLjEtLjMtLjEtLjctLjEtMS0uMi0uMSAwLS4yIDAtLjQtLjEtLjUtLjEtLjktLjEtMS40LS4xSDExNy42Yy02LjkgMC0xMi41IDUuNi0xMi41IDEyLjVzNS42IDEyLjUgMTIuNSAxMi41aDc5LjVjNC44IDAgOC43IDMuOSA4LjcgOC44IDAgMi40LTEgNC42LTIuNiA2LjItMS42IDEuNi0zLjggMi42LTYuMiAyLjZINzIuMmMtNi45IDAtMTIuNSA1LjYtMTIuNSAxMi41czUuNiAxMi41IDEyLjUgMTIuNWg5MC4xYzcuNiAwIDEzLjcgNi4yIDEzLjcgMTMuNyAwIDMuOC0xLjUgNy4yLTQgOS43LTIuNSAyLjUtNS44IDQtOS42IDRIMjguNWMtNi45IDAtMTIuNSA1LjYtMTIuNSAxMi41czUuNiAxMi41IDEyLjUgMTIuNWg4My4zYzkuNiAwIDE3LjUgNy45IDE3LjUgMTcuNSAwIDQuOC0yIDkuMi01LjEgMTIuNC0zLjIgMy4yLTcuNSA1LjEtMTIuMyA1LjFoLTUyYy02LjkgMC0xMi41IDUuNi0xMi41IDEyLjVzNS42IDEyLjUgMTIuNSAxMi41SDE1N2MzLjkgMCA3LjUgMS4yIDEwLjQgMy4zIDMuNCAyLjMgNi4xIDUuOCA3LjMgOS44LjYgMS44LjkgMy43LjkgNS44IDAgNS4yLTIuMSA5LjktNS41IDEzLjMtMy40IDMuNC04LjEgNS41LTEzLjMgNS41SDEyM2MtNi45IDAtMTIuNSA1LjYtMTIuNSAxMi41czUuNiAxMi41IDEyLjUgMTIuNUgyMDEuOWMyIDAgMy42IDEuNiAzLjYgMy42IDAgMS0uNCAxLjktMS4xIDIuNi0uNi43LTEuNiAxLjEtMi41IDEuMWgtMTcuMWMtNi45IDAtMTIuNSA1LjYtMTIuNSAxMi41czUuNiAxMi41IDEyLjUgMTIuNWgxODYuOGMuNSAwIDEgMCAxLjUtLjFzLjktLjEgMS4zLS4yYy4xIDAgLjEgMCAuMi0uMS40LS4xLjgtLjIgMS4xLS4zLjEgMCAuMi0uMS4yLS4xLjQtLjEuNy0uMyAxLS40LjEgMCAuMi0uMS4yLS4xLjMtLjIuNy0uNCAxLS42LjEgMCAuMS0uMS4yLS4xLjQtLjMuOC0uNSAxLjEtLjhsLjEtLjFjLjMtLjMuNi0uNS45LS44bC4zLS4zYy4yLS4yLjQtLjQuNi0uN2wuMi0uMiA5My43LTEyNC45YzMuNS00LjUgMy41LTEwLjYuMi0xNS4xek0yODggMTQzLjRoNTguN2wtMzcuNSA1MC0zNy41LTUwSDI4OHptLTEwOS4yIDk4LjggMTMtMTcuMyAzNC43LTQ2LjQgNS4zLTcuMSAxNC45LTE5LjggNi4zIDguNCA0MC41IDU0LTIxLjkgMjkuMkgxNzhsLjgtMXpNMjUzIDM2OC4zbC0xNS44LTIxLTQwLjYtNTQuMS05LjktMTMuMi04LjctMTEuNmg5My43bDc1IDEwMEgyNTN6bTE2OS4zLTc1LjhMMzkyIDI1NS44bC0xMy40IDE5LjEgMjkuOSAzNi4xLTM2LjcgNDktNzguMS0xMDQuMSA3OC4xLTEwNC4xIDc4LjEgMTA0LjEtMjcuNiAzNi42eiIvPjxsaW5lYXJHcmFkaWVudCBpZD0iYiIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI0MTMuMTExIiB5MT0iMTY2LjMwOSIgeDI9IjE0NS40NDUiIHkyPSIxNjYuMzA5Ij48c3RvcCBvZmZzZXQ9Ii4wMzQiIHN0eWxlPSJzdG9wLWNvbG9yOiNlNzAwZTYiLz48c3RvcCBvZmZzZXQ9IjEiIHN0eWxlPSJzdG9wLWNvbG9yOiMyOWFiZTIiLz48L2xpbmVhckdyYWRpZW50PjxwYXRoIGZpbGw9InVybCgjYikiIGQ9Ik0zMzEuOSAxNTIuNmgtNDIuN2wyMC42IDI3LjR6Ii8+PC9zdmc+",m=t(85893),j=function(g){var s=g.user,v=g.size,ee=v===void 0?24:v,G=g.marginLeft,c=G===void 0?6:G;return s===void 0?(0,m.jsx)(x.C,{size:ee,src:D,alt:"avatar"}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(x.C,{size:ee,className:O.avatar,src:s.avatar||w.Z.AVATAR_URL,alt:"avatar"}),(0,m.jsx)(Y.Z,{title:"\u70B9\u51FB\u53EF\u67E5\u770B\u7528\u6237\u8D44\u6599",children:s.deleted_at?(0,m.jsx)("del",{children:(0,m.jsx)("a",{style:{marginLeft:c,fontSize:13,color:"#ccc"},href:"/#/member/".concat(s.id),rel:"noreferrer",children:s.name})}):(0,m.jsx)("a",{onClick:function(P){P.stopPropagation()},style:{marginLeft:c,fontSize:13,verticalAlign:"middle"},href:"/#/member/".concat(s.id),rel:"noreferrer",children:s.name})})]})}},37594:function(ce,B,t){"use strict";t.d(B,{B:function(){return Y}});var R=t(91321),x="//at.alicdn.com/t/font_915840_2b8lahxt5xv.js",Y=(0,R.Z)({scriptUrl:x})},65245:function(ce,B,t){"use strict";t.d(B,{Z:function(){return c}});var R=t(19632),x=t.n(R),Y=t(13769),O=t.n(Y),w=t(15009),i=t.n(w),E=t(99289),b=t.n(E),H=t(97857),S=t.n(H),L=t(72051),u=t(95742),D=t(53682),m=t(62748),j=t(85893),g=["className","style"],s=(0,u.JV)(function(){return(0,j.jsx)(D.Z,{style:{cursor:"grab",color:"#999"}})}),v=[{title:"\u6392\u5E8F",dataIndex:"sort",width:65,className:"drag-visible",render:function(){return(0,j.jsx)(s,{})}}],ee=(0,u.gU)(function(M){return(0,j.jsx)("tr",S()({},M))}),G=(0,u.hv)(function(M){return(0,j.jsx)("tbody",S()({},M))}),c=function(M){var P=M.dataSource,me=M.columns,$=M.setDataSource,f=M.dragCallback,ve=M.loading,Le=function(){var te=b()(i()().mark(function z(ne){var ae,X,k,W;return i()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:if(ae=ne.oldIndex,X=ne.newIndex,ae===X){U.next=11;break}if(k=(0,m.q)([].concat(P),ae,X).filter(function(Me){return!!Me}),!f){U.next=10;break}return U.next=6,f(k);case 6:W=U.sent,(W||W===void 0)&&$(k),U.next=11;break;case 10:$(k);case 11:case"end":return U.stop()}},z)}));return function(ne){return te.apply(this,arguments)}}(),de=function(z){return(0,j.jsx)(G,S()({useDragHandle:!0,disableAutoscroll:!0,helperClass:"row-dragging",onSortEnd:Le},z))},he=function(z){var ne=z.className,ae=z.style,X=O()(z,g),k=P.findIndex(function(W){return W.index===X["data-row-key"]});return(0,j.jsx)(ee,S()({index:k},X))};return(0,j.jsx)(L.Z,{pagination:!1,dataSource:P,loading:ve,columns:[].concat(v,x()(me)),rowKey:"index",components:{body:{wrapper:de,row:he}}})}},90861:function(ce,B,t){"use strict";var R=t(34041),x=t(7134),Y=t(19478),O=t(67294),w=t(85893),i=R.Z.Option;B.Z=function(E){var b=E.users,H=E.placeholder,S=H===void 0?"\u8BF7\u9009\u62E9\u4EBA\u5458":H,L=E.onChange,u=E.value,D=E.mode,m=D===void 0?null:D;return(0,w.jsx)(R.Z,{allowClear:!0,onChange:L,value:u,showSearch:!0,placeholder:S,mode:m,filterOption:function(g,s){return s.props.children[2].toLowerCase().indexOf(g.toLowerCase())>-1||s.props.children[4].toLowerCase().indexOf(g.toLowerCase())>-1},children:b.map(function(j){return(0,w.jsxs)(i,{value:j.id,children:[(0,w.jsx)(x.C,{size:14,src:j.avatar||Y.Z.AVATAR_URL})," ",j.name,"(",j.email,")"]},j.id)})})}},95317:function(ce,B,t){"use strict";t.r(B),t.d(B,{default:function(){return Ue}});var R=t(15009),x=t.n(R),Y=t(99289),O=t.n(Y),w=t(97857),i=t.n(w),E=t(5574),b=t.n(E),H=t(58841),S=t(90596),L=t(34041),u=t(8232),D=t(83062),m=t(40411),j=t(66309),g=t(72269),s=t(96074),v=t(38925),ee=t(4393),G=t(71230),c=t(15746),M=t(55102),P=t(14726),me=t(72051),$=t(67294),f=t(19478),ve=t(63783),Le=t(51042),de=t(42119),he=t(59847),te=t(37804),z=t(17788),ne=t(55355),ae=t(36027),X=t(74070),k=t(60219),W=t(37594),Ze=t(65245),U=t(45855),Me=t.n(U),Fe=t(30381),Ne=t.n(Fe),Ae=t(90861),e=t(85893),fe=de.Z.Step,re=L.Z.Option,Te=function(l){var Q=l.dispatch,p=l.form,N=l.loading,y=l.caseMap,V=l.treeData,le=l.planRecord,K=l.onSave,ue=l.selectedCaseData,C=[{title:"\u7528\u4F8Bid",key:"case_id",dataIndex:"case_id",width:100,render:function(h){return h?h.split("_")[1]:null}},{title:"\u7528\u4F8B\u540D\u79F0",key:"name",dataIndex:"name",render:function(h){return(0,e.jsx)("a",{children:h})}}];return(0,$.useEffect)(function(){p.getFieldValue("project_id")&&Q({type:"testplan/listTestCaseTreeWithProjectId",payload:{project_id:p.getFieldValue("project_id")}})},[]),(0,$.useEffect)(function(){K({selectedCaseData:(p.getFieldValue("case_list")||[]).map(function(T,h){return{name:y[T.split("_")[1]],case_id:T,index:h}})})},[y]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(c.Z,{span:24,children:(0,e.jsx)(u.Z.Item,i()(i()({label:"\u7528\u4F8B\u6811",name:"case_list",rules:[{required:!0,message:"\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2Acase"}]},f.Z.SQL_LAYOUT),{},{children:(0,e.jsx)(he.Z,{treeData:V,treeCheckable:!0,style:{width:"100%"},showSearch:!0,allowClear:!0,maxTagCount:5,onChange:function(h,q){K({selectedCaseData:q.map(function(ie,Z){return{name:ie,case_id:h[Z],index:Z}})})},loading:N.effects["testplan/listTestCaseTreeWithProjectId"]})}))}),(0,e.jsx)(c.Z,{span:24,style:{marginTop:8},children:(0,e.jsx)(u.Z.Item,i()(i()({label:"\u7528\u4F8B\u8868",name:"caseList"},f.Z.SQL_LAYOUT),{},{children:(0,e.jsx)(Ze.Z,{columns:C,dataSource:ue,setDataSource:function(h){K({selectedCaseData:h})},dragCallback:function(h){p.setFieldsValue({case_list:h.map(function(q){return q.case_id})})}})}))})]})},Be=function(l){var Q=l.user,p=l.loading,N=l.project,y=l.testplan,V=l.dispatch,le=l.gconfig,K=l.fetchTestPlan,ue=y.visible,C=y.currentStep,T=y.title,h=y.treeData,q=y.selectedCaseData,ie=y.caseMap,Z=y.planRecord,ye=N.projects,ge=le.envList,Ie=Q.userList,se=u.Z.useForm(),Ee=b()(se,1),J=Ee[0],Se=(0,$.useState)(null),xe=b()(Se,2),De=xe[0],pe=xe[1],_=function(a){V({type:"testplan/save",payload:a})};(0,$.useEffect)(function(){J.resetFields(),J.setFieldsValue(Z)},[Z]);var Ce=function(){var n=O()(x()().mark(function a(){var d,A;return x()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(d=J.getFieldsValue(["name","env","priority","cron","ordered","case_list","project_id","pass_rate","retry_minutes","msg_type","receiver"]),!Z.id){F.next=7;break}return F.next=4,V({type:"testplan/updateTestPlan",payload:i()(i()({},d),{},{id:Z.id,case_list:d.case_list.map(function(oe){return parseInt(oe.split("_")[1],10)})})});case 4:A=F.sent,F.next=10;break;case 7:return F.next=9,V({type:"testplan/insertTestPlan",payload:i()(i()({},d),{},{case_list:d.case_list.map(function(oe){return parseInt(oe.split("_")[1],10)})})});case 9:A=F.sent;case 10:A&&(_({visible:!1}),K());case 11:case"end":return F.stop()}},a)}));return function(){return n.apply(this,arguments)}}(),r=function(){if(C===0)return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(c.Z,{span:12,children:(0,e.jsx)(u.Z.Item,{label:"\u9879\u76EE",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u9879\u76EE"}],name:"project_id",children:(0,e.jsx)(L.Z,{allowClear:!0,showSearch:!0,placeholder:"\u9009\u62E9\u9879\u76EE",filterOption:function(d,A){return A.children.toLowerCase().indexOf(d.toLowerCase())>=0},children:ye.map(function(a){return(0,e.jsx)(re,{value:a.id,children:a.name},a.id)})})})}),(0,e.jsx)(c.Z,{span:12,children:(0,e.jsx)(u.Z.Item,{label:"\u8BA1\u5212\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u6D4B\u8BD5\u8BA1\u5212\u540D\u79F0"}],name:"name",children:(0,e.jsx)(M.Z,{placeholder:"\u8F93\u5165\u6D4B\u8BD5\u8BA1\u5212\u540D\u79F0"})})}),(0,e.jsx)(c.Z,{span:12,children:(0,e.jsx)(u.Z.Item,{label:"\u8FD0\u884C\u73AF\u5883",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u8981\u8FD0\u884C\u7684\u73AF\u5883, \u652F\u6301\u591A\u9009"}],name:"env",children:(0,e.jsx)(L.Z,{placeholder:"\u8BF7\u9009\u62E9\u8981\u8FD0\u884C\u7684\u73AF\u5883",allowClear:!0,mode:"multiple",children:ge.map(function(a){return(0,e.jsx)(re,{value:a.id,children:a.name},a.id)})})})}),(0,e.jsx)(c.Z,{span:12,children:(0,e.jsx)(u.Z.Item,{label:"\u4F18\u5148\u7EA7",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u6D4B\u8BD5\u8BA1\u5212\u4F18\u5148\u7EA7"}],name:"priority",children:(0,e.jsx)(L.Z,{placeholder:"\u9009\u62E9\u4F18\u5148\u7EA7",allowClear:!0,children:f.Z.PRIORITY.map(function(a){return(0,e.jsx)(re,{value:a,children:a},a)})})})}),(0,e.jsx)(c.Z,{span:12,children:(0,e.jsx)(u.Z.Item,{label:"cron\u8868\u8FBE\u5F0F",extra:(0,e.jsx)("div",{className:"m-input-footer-msg",children:De||"* cron\u8868\u8FBE\u5F0F\u53EA\u652F\u63015\u4F4D!"}),rules:[{required:!0},function(a){var d=a.getFieldValue;return{validator:function(o,F){if(F===""){pe(null);return}try{var oe=Me().parseExpression(F);return pe("\u4E0B\u6B21\u8FD0\u884C\u65F6\u95F4: ".concat(Ne()(new Date(oe.next())).format("YYYY-MM-DD HH:mm:ss"))),Promise.resolve()}catch(Re){return Promise.reject(new Error("\u8BF7\u8F93\u5165\u6B63\u786E\u7684cron\u8868\u8FBE\u5F0F"))}}}}],name:"cron",children:(0,e.jsx)(M.Z,{placeholder:"\u8BF7\u8F93\u5165\u6267\u884Ccron\u8868\u8FBE\u5F0F"})})}),(0,e.jsx)(c.Z,{span:12,children:(0,e.jsx)(u.Z.Item,{label:"\u987A\u5E8F\u6267\u884C",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u6D4B\u8BD5\u8BA1\u5212\u662F\u5426\u9700\u8981\u987A\u5E8F\u6267\u884C"}],name:"ordered",children:(0,e.jsxs)(L.Z,{placeholder:"\u662F\u5426\u9700\u8981\u987A\u5E8F\u6267\u884C",allowClear:!0,children:[(0,e.jsx)(re,{value:!1,children:"\u5426"}),(0,e.jsx)(re,{value:!0,children:"\u662F"})]})})})]});if(C===1)return(0,e.jsx)(Te,{dispatch:V,treeData:h,planRecord:Z,form:J,onSave:_,selectedCaseData:q,caseMap:ie,loading:p});if(C===2)return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(c.Z,{span:12,children:(0,e.jsx)(u.Z.Item,{label:"\u5408\u683C\u7387(%)",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6D4B\u8BD5\u8BA1\u5212\u7684\u6700\u4F4E\u901A\u8FC7\u7387"}],name:"pass_rate",children:(0,e.jsx)(te.Z,{placeholder:"\u8BF7\u8F93\u5165\u6D4B\u8BD5\u8BA1\u5212\u7684\u6700\u4F4E\u901A\u8FC7\u7387",style:{width:"100%"},max:100,min:1})})}),(0,e.jsx)(c.Z,{span:12,children:(0,e.jsx)(u.Z.Item,{label:"\u91CD\u8BD5\u7B49\u5F85(min)",rules:[{required:!1}],name:"retry_minutes",children:(0,e.jsx)(te.Z,{placeholder:"\u91CD\u8BD5\u7B49\u5F85\u65F6\u95F4, \u4E0D\u586B\u5219\u4E0D\u91CD\u8BD5",style:{width:"100%"},min:0})})}),(0,e.jsx)(c.Z,{span:24,children:(0,e.jsx)(u.Z.Item,i()(i()({label:"\u63A8\u9001\u65B9\u5F0F",rules:[{required:!1,message:"\u8BF7\u9009\u62E9\u63A8\u9001\u65B9\u5F0F"}],name:"msg_type"},f.Z.SQL_LAYOUT),{},{children:(0,e.jsx)(L.Z,{allowClear:!0,showSearch:!0,placeholder:"\u8BF7\u9009\u62E9\u63A8\u9001\u65B9\u5F0F",mode:"multiple",children:Object.keys(f.Z.MSG_TYPE).map(function(a){return(0,e.jsxs)(re,{value:a,children:[(0,e.jsx)(W.B,{type:f.Z.MSG_ICON[a],style:{fontSize:18}})," ",f.Z.MSG_TYPE[a]]},a)})})}))}),(0,e.jsx)(c.Z,{span:24,children:(0,e.jsx)(u.Z.Item,i()(i()({label:"\u63A8\u9001\u7528\u6237",rules:[{required:!1,message:"\u8BF7\u9009\u62E9\u63A8\u9001\u4EBA\u5458"}],name:"receiver"},f.Z.SQL_LAYOUT),{},{children:(0,e.jsx)(Ae.Z,{users:Ie,mode:"multiple"})}))})]})};return(0,e.jsx)(z.Z,{width:700,open:ue,title:T,style:{marginTop:-40},footer:null,onCancel:function(){_({visible:!1})},children:(0,e.jsxs)(u.Z,i()(i()({form:J},f.Z.SUB_LAYOUT),{},{initialValues:Z,children:[(0,e.jsxs)(de.Z,{current:C,size:"small",children:[(0,e.jsx)(fe,{title:"\u57FA\u7840\u4FE1\u606F",icon:(0,e.jsx)(ne.Z,{})}),(0,e.jsx)(fe,{title:"\u9009\u62E9\u7528\u4F8B",icon:(0,e.jsx)(ae.Z,{})}),(0,e.jsx)(fe,{title:"\u901A\u77E5\u8BBE\u7F6E",icon:(0,e.jsx)(X.Z,{})})]}),(0,e.jsxs)(G.Z,{gutter:[8,8],style:{marginTop:24},children:[r(),(0,e.jsxs)("div",{style:{margin:"24px auto"},children:[C===0?null:(0,e.jsxs)(P.ZP,{style:{marginRight:8},onClick:function(){_({currentStep:C-1})},children:[(0,e.jsx)(W.B,{type:"icon-shangyibu1"})," \u4E0A\u4E00\u6B65"]}),C<2?(0,e.jsxs)(P.ZP,{type:"primary",onClick:function(){J.validateFields().then(function(){_({currentStep:C+1})})},children:[(0,e.jsx)(W.B,{type:"icon--xiayibu"})," \u4E0B\u4E00\u6B65"]}):(0,e.jsxs)(P.ZP,{type:"primary",onClick:Ce,children:[(0,e.jsx)(k.Z,{})," \u4FDD\u5B58"]})]})]})]}))})},Oe=(0,S.connect)(function(I){var l=I.user,Q=I.loading,p=I.project,N=I.testplan,y=I.gconfig;return{user:l,loading:Q,project:p,testplan:N,gconfig:y}})(Be),Pe=t(12554),je=L.Z.Option,ze=function(l){var Q=l.testplan,p=l.dispatch,N=l.loading,y=l.gconfig,V=l.user,le=l.project,K=Q.planData,ue=V.userList,C=V.userMap,T=le.projectsMap,h=le.projects,q=u.Z.useForm(),ie=b()(q,1),Z=ie[0],ye=function(n){return n.state===2?(0,e.jsx)(D.Z,{title:"\u5B9A\u65F6\u4EFB\u52A1\u53EF\u80FD\u6DFB\u52A0\u5931\u8D25, \u8BF7\u5C1D\u8BD5\u91CD\u65B0\u6DFB\u52A0",children:(0,e.jsx)(m.Z,{status:"error",text:"\u51FA\u9519"})}):n.state===3?(0,e.jsx)(D.Z,{title:"\u4EFB\u52A1\u5DF2\u6682\u505C",children:(0,e.jsx)(m.Z,{status:"warning",text:"\u5DF2\u6682\u505C"})}):n.state===1?(0,e.jsx)(D.Z,{title:"\u4EFB\u52A1\u6B63\u5728\u6267\u884C\u4E2D",children:(0,e.jsx)(m.Z,{status:"processing",text:"\u6267\u884C\u4E2D"})}):(0,e.jsx)(D.Z,{title:"\u4E0B\u6B21\u8FD0\u884C\u65F6\u95F4: ".concat(n.next_run),children:(0,e.jsx)(m.Z,{status:"success",text:"\u7B49\u5F85\u4E2D"})})},ge=function(n){p({type:"testplan/save",payload:n})},Ie=function(n){ge({visible:!0,currentStep:0,title:"\u7F16\u8F91\u6D4B\u8BD5\u8BA1\u5212: ".concat(n.name),planRecord:i()(i()({},n),{},{msg_type:n.msg_type===""?[]:n.msg_type.split(","),receiver:n.receiver===""?[]:n.receiver.split(",").map(function(a){return parseInt(a,10)}),env:n.env===""?[]:n.env.split(",").map(function(a){return parseInt(a,10)}),case_list:n.case_list===""?[]:n.case_list.split(",").map(function(a){return"testcase_".concat(a)})})})},se=function(){var n=Z.getFieldsValue();p({type:"testplan/listTestPlan",payload:i()({page:1,size:10},n)})},Ee=function(){var r=O()(x()().mark(function n(a){var d;return x()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,p({type:"testplan/deleteTestPlan",payload:{id:a}});case 2:d=o.sent,d&&se();case 4:case"end":return o.stop()}},n)}));return function(a){return r.apply(this,arguments)}}(),J=function(n,a){var d=a?"testplan/followTestPlan":"testplan/unFollowTestPlan";p({type:d,payload:{id:n}})},Se=function(){var r=O()(x()().mark(function n(a){var d;return x()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,p({type:"testplan/executeTestPlan",payload:{id:a}});case 2:d=o.sent;case 3:case"end":return o.stop()}},n)}));return function(a){return r.apply(this,arguments)}}(),xe=[{title:"\u9879\u76EE",key:"project_id",dataIndex:"project_id",render:function(n){return(0,e.jsx)("a",{href:"/#/project/".concat(n),rel:"noreferrer",children:T[n]||"loading"})}},{title:"\u6D4B\u8BD5\u8BA1\u5212",key:"name",dataIndex:"name"},{title:"\u4F18\u5148\u7EA7",key:"priority",dataIndex:"priority",render:function(n){return(0,e.jsx)(j.Z,{color:f.Z.CASE_TAG[n],children:n})}},{title:"cron\u8868\u8FBE\u5F0F",key:"cron",dataIndex:"cron"},{title:"\u987A\u5E8F\u6267\u884C",key:"ordered",dataIndex:"ordered",render:function(n){return n?(0,e.jsx)(j.Z,{color:"blue",children:"\u662F"}):(0,e.jsx)(j.Z,{children:"\u5426"})}},{title:"\u7528\u4F8B\u6570\u91CF",key:"case_list",dataIndex:"case_list",render:function(n){return n.split(",").length}},{title:"\u72B6\u6001",key:"next_run",dataIndex:"next_run",render:function(n,a){return ye(a)}},{title:(0,e.jsxs)("span",{children:["\u662F\u5426\u5173\u6CE8 ",(0,e.jsx)(D.Z,{title:"\u70B9\u51FB\u53EF\u5173\u6CE8\u9879\u76EE\u6570\u636E",children:(0,e.jsx)(ve.Z,{})})]}),key:"follow",dataIndex:"follow",render:function(n,a){return(0,e.jsx)(g.Z,{defaultChecked:n,onChange:function(A){J(a.id,A)}})}},{title:"\u521B\u5EFA\u4EBA",key:"create_user",dataIndex:"create_user",render:function(n){return(0,e.jsx)(Pe.Z,{user:C[n]})}},{title:"\u64CD\u4F5C",key:"ops",render:function(n,a){return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("a",{onClick:function(){Ie(a)},children:"\u7F16\u8F91"}),(0,e.jsx)(s.Z,{type:"vertical"}),(0,e.jsx)("a",{onClick:O()(x()().mark(function d(){return x()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,Se(a.id);case 2:case"end":return o.stop()}},d)})),children:"\u8FD0\u884C"}),(0,e.jsx)(s.Z,{type:"vertical"}),(0,e.jsx)("a",{onClick:O()(x()().mark(function d(){return x()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,Ee(a.id);case 2:case"end":return o.stop()}},d)})),children:"\u5220\u9664"})]})}}],De=N.effects["testplan/listTestPlan"]||N.effects["project/listProject"]||N.effects["testplan/executeTestPlan"],pe=function(){p({type:"project/listProject"})},_=function(){ue.length===0&&p({type:"user/fetchUserList"})},Ce=function(){p({type:"gconfig/fetchEnvList",payload:{page:1,size:1e3,exactly:!0}})};return(0,$.useEffect)(function(){Ce(),_(),pe(),se()},[]),(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(H._z,{title:!1,breadcrumb:null,children:[(0,e.jsx)(v.Z,{message:"\u6267\u884C\u6D4B\u8BD5\u8BA1\u5212\u524D\uFF0C\u8BB0\u5F97\u4FEE\u6539\u6D4B\u8BD5\u8BA1\u5212\u63A5\u6536\u4EBA, \u8FD9\u6837\u5C31\u80FD\u6536\u5230\u90AE\u4EF6\u901A\u77E5\u5566\u{1F608}~",style:{marginBottom:16},type:"info",banner:!0,closable:!0}),(0,e.jsxs)(ee.Z,{children:[(0,e.jsx)(Oe,{fetchTestPlan:se}),(0,e.jsx)(u.Z,i()(i()({form:Z},f.Z.LAYOUT),{},{onValuesChange:function(){se()},children:(0,e.jsxs)(G.Z,{gutter:[12,12],children:[(0,e.jsx)(c.Z,{span:5,children:(0,e.jsx)(u.Z.Item,{label:"\u9879\u76EE",name:"project_id",children:(0,e.jsx)(L.Z,{allowClear:!0,showSearch:!0,placeholder:"\u9009\u62E9\u9879\u76EE",children:h.map(function(r){return(0,e.jsx)(je,{value:r.id,children:r.name},r.id)})})})}),(0,e.jsx)(c.Z,{span:5,children:(0,e.jsx)(u.Z.Item,{label:"\u540D\u79F0",name:"name",children:(0,e.jsx)(M.Z,{placeholder:"\u8F93\u5165\u6D4B\u8BD5\u8BA1\u5212\u540D\u79F0"})})}),(0,e.jsx)(c.Z,{span:4,children:(0,e.jsx)(u.Z.Item,{label:"\u4F18\u5148\u7EA7",name:"priority",children:(0,e.jsx)(L.Z,{placeholder:"\u9009\u62E9\u4F18\u5148\u7EA7",allowClear:!0,children:f.Z.PRIORITY.map(function(r){return(0,e.jsx)(je,{value:r,children:r},r)})})})}),(0,e.jsx)(c.Z,{span:5,children:(0,e.jsx)(u.Z.Item,{label:"\u5173\u6CE8",name:"follow",children:(0,e.jsxs)(L.Z,{placeholder:"\u9009\u62E9\u662F\u5426\u5173\u6CE8",allowClear:!0,children:[(0,e.jsx)(je,{value:"true",children:"\u662F"}),(0,e.jsx)(je,{value:"false",children:"\u5426"})]})})}),(0,e.jsx)(c.Z,{span:5,children:(0,e.jsx)(u.Z.Item,{label:"\u521B\u5EFA\u4EBA",name:"create_user",children:(0,e.jsx)(Ae.Z,{users:ue})})})]})})),(0,e.jsx)(G.Z,{style:{marginBottom:12},children:(0,e.jsxs)(P.ZP,{type:"primary",onClick:function(){ge({visible:!0,title:"\u65B0\u589E\u6D4B\u8BD5\u8BA1\u5212",planRecord:{},currentStep:0})},children:[(0,e.jsx)(Le.Z,{})," \u6DFB\u52A0\u8BA1\u5212"]})}),(0,e.jsx)(me.Z,{columns:xe,dataSource:K,rowKey:function(n){return n.id},loading:De})]})]})})},Ue=(0,S.connect)(function(I){var l=I.testplan,Q=I.project,p=I.user,N=I.loading,y=I.gconfig;return{testplan:l,project:Q,loading:N,user:p,gconfig:y}})(ze)},37281:function(){}}]);
